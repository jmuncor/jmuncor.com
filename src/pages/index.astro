---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts';
import { getNumberedPosts } from '../lib/posts';

const posts = (await getNumberedPosts()).reverse();
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
		<style>
			html {
				scroll-snap-type: y mandatory;
			}

			main {
				padding: 0 2rem;
			}

			.post-list {
				list-style: none;
				margin: 0;
				padding: 40vh 0 50vh;
			}

			.post-item {
				scroll-snap-align: center;
				padding: 0.75rem 0;
			}

			.post-link {
				display: flex;
				align-items: baseline;
				gap: 1.5rem;
				text-decoration: none;
				color: var(--color-text);
			}

			.post-number {
				font-size: 2.5rem;
				font-weight: 700;
				flex-shrink: 0;
			}

			.post-title {
				font-size: 2.5rem;
				font-weight: 700;
				line-height: 1.2;
			}

			@media (max-width: 720px) {
				main {
					padding: 0 1.5rem;
				}

				.post-number,
				.post-title {
					font-size: 1.75rem;
				}
			}
		</style>
	</head>
	<body>
		<Header />
		<main>
			<ul class="post-list">
				{posts.map((post) => (
					<li class="post-item">
						<a href={`/blog/${post.id}/`} class="post-link">
							<span class="post-number">{post.number}</span>
							<span class="post-title">{post.data.title}</span>
						</a>
					</li>
				))}
			</ul>
		</main>
		<script>
			const items = document.querySelectorAll('.post-item');
			const headerHeight = 64;

			function updatePosts() {
				const viewportCenter = (window.innerHeight + headerHeight) / 2;
				items.forEach(item => {
					const rect = item.getBoundingClientRect();
					const itemCenter = rect.top + rect.height / 2;
					const distance = Math.abs(viewportCenter - itemCenter);
					const maxDistance = window.innerHeight * 0.4;
					const opacity = Math.max(0.15, 1 - Math.pow(distance / maxDistance, 0.7));
					item.style.opacity = opacity.toString();
				});
			}

			window.addEventListener('scroll', updatePosts, { passive: true });
			window.addEventListener('resize', updatePosts);
			updatePosts();
		</script>
	</body>
</html>
